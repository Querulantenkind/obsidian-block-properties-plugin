/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var U=Object.defineProperty;var ae=Object.getOwnPropertyDescriptor;var ce=Object.getOwnPropertyNames;var pe=Object.prototype.hasOwnProperty;var de=(d,i)=>{for(var e in i)U(d,e,{get:i[e],enumerable:!0})},ue=(d,i,e,s)=>{if(i&&typeof i=="object"||typeof i=="function")for(let t of ce(i))!pe.call(d,t)&&t!==e&&U(d,t,{get:()=>i[t],enumerable:!(s=ae(i,t))||s.enumerable});return d};var he=d=>ue(U({},"__esModule",{value:!0}),d);var we={};de(we,{default:()=>_});module.exports=he(we);var le=require("obsidian");var Q=require("@codemirror/state"),E=require("@codemirror/view");var Z=/\[\[([^\]|]+)(?:\|([^\]]+))?\]\]/g,ee=/\^([\w-]+)/g;function R(d){var s;let i=[];Z.lastIndex=0;let e;for(;(e=Z.exec(d))!==null;){let t=e[1];!t||t.trim()===""||i.push({type:"note",raw:e[0],target:t.trim(),alias:(s=e[2])==null?void 0:s.trim()})}for(ee.lastIndex=0;(e=ee.exec(d))!==null;){let t=e[1];if(!t)continue;let n=e.index;i.some(l=>{if(l.type!=="note")return!1;let a=d.indexOf(l.raw),c=a+l.raw.length;return n>=a&&n<c})||i.push({type:"block",raw:e[0],target:t})}return{raw:d,links:i}}function M(d){let i=R(d),e=[];for(let s of i.links){let t=0,n;for(;(n=d.indexOf(s.raw,t))!==-1;){if(!e.some(l=>l.from===n&&l.link.raw===s.raw)){e.push({from:n,to:n+s.raw.length,link:s});break}t=n+1}}return e.sort((s,t)=>s.from-t.from),e}var te=/\^([\w-]+)\s*\[([^\]]+)\]/g;function b(d,i=0){let e=[],s;for(te.lastIndex=0;(s=te.exec(d))!==null;){let t=s[1],n=s[2];if(!t||!n)continue;let o=me(n);e.push({blockId:t,properties:o,from:i+s.index,to:i+s.index+s[0].length})}return e}function me(d){let i=[],e=d.split(",");for(let s of e){let t=s.indexOf(":");if(t===-1)continue;let n=s.slice(0,t).trim(),o=s.slice(t+1).trim();if(n){let l=R(o);i.push({key:n,value:o,parsedValue:l})}}return i}function ke(d,i,e){let s=d.metadataCache.getFirstLinkpathDest(i,e);return{file:s,exists:s!==null}}async function ge(d,i,e,s=!0){if(e){let t=await d.vault.cachedRead(e),n=se(t,i);if(n!==-1)return{file:e,blockId:i,line:n,exists:!0}}if(s)for(let t of d.vault.getMarkdownFiles()){if(t===e)continue;let n=await d.vault.cachedRead(t),o=se(n,i);if(o!==-1)return{file:t,blockId:i,line:o,exists:!0}}return{file:null,exists:!1}}function se(d,i){let e=d.split(`
`),s=new RegExp(`\\^${i}(?:\\s|\\[|$)`);for(let t=0;t<e.length;t++){let n=e[t];if(n&&s.test(n))return t}return-1}async function V(d,i,e,s){if(i.type==="note"){let t=ke(d,i.target,e);if(t.file)return await d.workspace.getLeaf().openFile(t.file),!0}else if(i.type==="block"){let t=await ge(d,i.target,s);if(t.file&&t.line!==void 0){let n=d.workspace.getLeaf();await n.openFile(t.file);let o=n.view;return o.getViewType()==="markdown"&&setTimeout(()=>{let l=o.editor;l&&(l.setCursor({line:t.line,ch:0}),l.scrollIntoView({from:{line:t.line,ch:0},to:{line:t.line,ch:0}},!0))},100),!0}}return!1}function ne(d){return d.toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}function fe(d){let i=[];for(let e of d){let s=ne(e.key),t=ne(e.value);!s||!t||i.push(`bp-${s}-${t}`)}return i}function ye(d,i){let e=[];for(let s of i)d.find(n=>n.key===s.key&&(s.value==="*"||n.value===s.value))&&s.className&&e.push(s.className);return e}function L(d,i){if(!i.enableConditionalStyling)return[];let e=fe(d),s=ye(d,i.customStyleRules);return[...e,...s]}var z=class extends E.WidgetType{constructor(e,s,t=[]){super();this.blockId=e;this.properties=s;this.conditionalClasses=t}toDOM(){let e=document.createElement("span");e.className=["block-property-badge",...this.conditionalClasses].join(" "),e.setAttribute("data-block-id",this.blockId),e.setAttribute("data-properties",JSON.stringify(this.properties));let s=this.properties.length;return e.textContent=`${s}`,e.title=this.properties.map(t=>`${t.key}: ${t.value}`).join(", "),e}eq(e){return this.blockId===e.blockId&&JSON.stringify(this.properties)===JSON.stringify(e.properties)&&JSON.stringify(this.conditionalClasses)===JSON.stringify(e.conditionalClasses)}};function ve(d,i){class e{constructor(t){this.decorations=this.buildDecorations(t)}update(t){(t.docChanged||t.viewportChanged)&&(this.decorations=this.buildDecorations(t.view))}destroy(){}buildDecorations(t){let n=new Q.RangeSetBuilder,o=[];for(let{from:l,to:a}of t.visibleRanges){let c=t.state.doc.sliceString(l,a),p=b(c,l);for(let r of p){let h=t.state.doc.sliceString(r.from,r.to).indexOf("[");if(h!==-1){let g=r.from+h,m=r.to,f=L(r.properties,i);if(i.enableConditionalStyling&&i.stylingTarget==="line"&&f.length>0){let k=t.state.doc.lineAt(r.from);o.push({from:k.from,to:k.from,decoration:E.Decoration.line({class:["bp-styled-line",...f].join(" ")})})}if(d==="badge"){let k=new z(r.blockId,r.properties,f);o.push({from:g,to:m,decoration:E.Decoration.replace({widget:k})})}else{let k=["block-property",...f];o.push({from:g,to:m,decoration:E.Decoration.mark({class:k.join(" ")})})}}}}o.sort((l,a)=>l.from-a.from||l.to-a.to);for(let l of o)n.add(l.from,l.to,l.decoration);return n.finish()}}return E.ViewPlugin.fromClass(e,{decorations:s=>s.decorations})}var be=(0,E.hoverTooltip)((d,i)=>{let e=d.state.doc.lineAt(i),s=e.text,t=e.from,n=b(s,t);for(let o of n){let a=d.state.doc.sliceString(o.from,o.to).indexOf("[");if(a!==-1){let c=o.from+a,p=o.to;if(i>=c&&i<=p)return{pos:c,above:!0,create(){let r=document.createElement("div");r.className="block-properties-tooltip";let u=document.createElement("div");u.className="block-properties-tooltip-header",u.textContent=`^${o.blockId}`,r.appendChild(u);let h=document.createElement("div");h.className="block-properties-tooltip-list";for(let g of o.properties){let m=document.createElement("div");m.className="block-properties-tooltip-item";let f=document.createElement("span");f.className="block-properties-tooltip-key",f.textContent=g.key;let k=document.createElement("span");k.className="block-properties-tooltip-value",k.textContent=g.value,m.appendChild(f),m.appendChild(k),h.appendChild(m)}return r.appendChild(h),{dom:r}}}}}return null}),Ee=E.Decoration.mark({class:"block-property-link"}),W=new WeakMap;function xe(){class d{constructor(e){this.linkPositions=[];let s=this.buildLinkDecorations(e);this.decorations=s.decorations,this.linkPositions=s.positions,W.set(e,this.linkPositions)}update(e){if(e.docChanged||e.viewportChanged){let s=this.buildLinkDecorations(e.view);this.decorations=s.decorations,this.linkPositions=s.positions,W.set(e.view,this.linkPositions)}}destroy(){}buildLinkDecorations(e){let s=new Q.RangeSetBuilder,t=[];for(let{from:n,to:o}of e.visibleRanges){let l=e.state.doc.sliceString(n,o),a=b(l,n);for(let c of a){let p=e.state.doc.sliceString(c.from,c.to),r=p.indexOf("["),u=p.lastIndexOf("]");if(r===-1||u===-1)continue;let h=p.slice(r+1,u),g=c.from+r+1,m=0;for(let f of c.properties){let k=`${f.key}: ${f.value}`,v=h.indexOf(k,m);if(v===-1)continue;let P=v+f.key.length+2,T=g+P,C=M(f.value);for(let B of C){let X=T+B.from,Y=T+B.to;s.add(X,Y,Ee),t.push({from:X,to:Y,link:B.link})}m=v+k.length}}}return{decorations:s.finish(),positions:t}}}return E.ViewPlugin.fromClass(d,{decorations:i=>i.decorations})}function Pe(d){return E.EditorView.domEventHandlers({click:(i,e)=>{if(!i.metaKey&&!i.ctrlKey)return!1;let s=e.posAtCoords({x:i.clientX,y:i.clientY});if(s===null)return!1;let t=W.get(e);if(!t)return!1;for(let n of t)if(s>=n.from&&s<=n.to){i.preventDefault();let o=d.workspace.getActiveFile(),l=(o==null?void 0:o.path)||"";return V(d,n.link,l,o||void 0),!0}return!1}})}function J(d,i,e){let s=[ve(d,i),be];return e&&(s.push(xe()),s.push(Pe(e))),s}var x=require("obsidian");var I="block-properties-panel",$=class extends x.ItemView{constructor(e,s){super(e);this.currentFile=null;this.plugin=s}getViewType(){return I}getDisplayText(){return"Block Properties"}getIcon(){return"tag"}async onOpen(){this.renderPanel()}async onClose(){}async updateForFile(e){this.currentFile=e,this.renderPanel()}async renderPanel(){let{contentEl:e}=this;e.empty(),e.addClass("block-properties-panel");let s=e.createEl("div",{cls:"block-properties-panel-header"});if(!this.currentFile){s.createEl("h4",{text:"Block Properties"}),e.createEl("p",{text:"No file open",cls:"block-properties-panel-empty"});return}s.createEl("h4",{text:this.currentFile.basename});let t=await this.app.vault.cachedRead(this.currentFile),n=this.extractBlocks(t);if(n.length===0){e.createEl("p",{text:"No block properties found",cls:"block-properties-panel-empty"});return}let o=e.createEl("p",{cls:"block-properties-panel-count"});o.textContent=`${n.length} block(s) with properties`;let l=e.createEl("div",{cls:"block-properties-panel-list"});for(let r of n){let h=["block-properties-panel-item",...L(r.properties,this.plugin.settings)],g=l.createEl("div",{cls:h.join(" ")}),m=g.createEl("div",{cls:"block-properties-panel-item-header"});m.createEl("a",{text:`^${r.blockId}`,cls:"block-properties-panel-link"}).addEventListener("click",()=>{this.navigateToBlock(r.line)}),r.context&&m.createEl("span",{text:r.context,cls:"block-properties-panel-context"});let k=g.createEl("div",{cls:"block-properties-panel-props"});for(let P of r.properties){let T=k.createEl("div",{cls:"block-properties-panel-prop"});T.createEl("span",{text:P.key,cls:"block-properties-panel-key"});let C=T.createEl("div",{cls:"block-properties-panel-value-container"});this.renderPropertyValue(C,P.value,r,P.key);let B=T.createEl("button",{cls:"block-properties-panel-delete-btn",attr:{"aria-label":"Delete property"}});B.innerHTML="&times;",B.addEventListener("click",()=>{this.deleteProperty(r,P.key)})}let v=k.createEl("button",{text:"+ Add property",cls:"block-properties-panel-add-btn"});v.addEventListener("click",()=>{this.startAddingProperty(k,r,v)})}this.plugin.settings.showBacklinksInPanel&&await this.renderBacklinks(e,n);let a=e.createEl("div",{cls:"block-properties-panel-summary"});a.createEl("h5",{text:"Summary"});let c=this.countKeys(n),p=a.createEl("div",{cls:"block-properties-panel-summary-list"});for(let[r,u]of Object.entries(c)){let h=p.createEl("div",{cls:"block-properties-panel-summary-item"});h.createEl("span",{text:r,cls:"block-properties-panel-summary-key"}),h.createEl("span",{text:`${u}`,cls:"block-properties-panel-summary-count"})}}extractBlocks(e){let s=[],t=e.split(`
`);for(let n=0;n<t.length;n++){let o=t[n];if(!o)continue;let l=b(o);for(let a of l){let c=o.slice(0,a.from).trim().slice(0,40),r=o.slice(a.from,a.to).indexOf("[");s.push({blockId:a.blockId,properties:a.properties,line:n,context:c||"(start of line)",blockStart:a.from,propsStart:a.from+r,propsEnd:a.to-1})}}return s}countKeys(e){let s={};for(let t of e)for(let n of t.properties)s[n.key]=(s[n.key]||0)+1;return s}navigateToBlock(e){let s=this.app.workspace.getActiveViewOfType(x.MarkdownView);if(s){let t=s.editor;t.setCursor({line:e,ch:0}),t.scrollIntoView({from:{line:e,ch:0},to:{line:e,ch:0}},!0),t.focus()}}renderPropertyValue(e,s,t,n){if(!s){e.createEl("span",{text:"(empty)",cls:"block-properties-panel-value is-empty"}).addEventListener("click",()=>{this.startEditingValue(e,t,n,s)});return}let o=M(s);if(o.length===0){e.createEl("span",{text:s,cls:"block-properties-panel-value"}).addEventListener("click",()=>{this.startEditingValue(e,t,n,s)});return}let l=e.createEl("span",{cls:"block-properties-panel-value block-properties-panel-value-with-links"}),a=0;for(let p of o)p.from>a&&l.createEl("span",{text:s.slice(a,p.from)}).addEventListener("click",()=>{this.startEditingValue(e,t,n,s)}),l.createEl("a",{text:p.link.alias||p.link.target,cls:`block-properties-panel-link-value block-properties-link-${p.link.type}`}).addEventListener("click",async u=>{var m;u.stopPropagation();let h=((m=this.currentFile)==null?void 0:m.path)||"";await V(this.app,p.link,h,this.currentFile||void 0)||new x.Notice(`Could not find ${p.link.type==="note"?"note":"block"}: ${p.link.target}`)}),a=p.to;a<s.length&&l.createEl("span",{text:s.slice(a)}).addEventListener("click",()=>{this.startEditingValue(e,t,n,s)}),l.createEl("span",{text:" \u270E",cls:"block-properties-panel-edit-icon"}).addEventListener("click",()=>{this.startEditingValue(e,t,n,s)})}async renderBacklinks(e,s){let t=this.plugin.getBacklinkIndex();if(!t)return;let n=[];for(let l of s){let a=t.getBacklinksForBlock(l.blockId);a.length>0&&n.push({targetId:`^${l.blockId}`,entries:a})}if(n.length===0)return;let o=e.createEl("div",{cls:"block-properties-panel-backlinks"});o.createEl("h5",{text:"Referenced by"});for(let{targetId:l,entries:a}of n){o.createEl("div",{cls:"block-properties-panel-backlinks-target"}).createEl("span",{text:l,cls:"block-properties-panel-backlinks-target-id"});let p=o.createEl("div",{cls:"block-properties-panel-backlinks-list"});for(let r of a){let u=p.createEl("div",{cls:"block-properties-panel-backlinks-item"}),h=this.app.vault.getAbstractFileByPath(r.sourceFile),g=h instanceof x.TFile?`${h.basename} \u2192 ^${r.sourceBlockId}`:`${r.sourceFile} \u2192 ^${r.sourceBlockId}`;u.createEl("a",{text:g,cls:"block-properties-panel-backlinks-link"}).addEventListener("click",async()=>{h instanceof x.TFile&&(await this.app.workspace.getLeaf().openFile(h),setTimeout(()=>{let k=this.app.workspace.getActiveViewOfType(x.MarkdownView);if(k){let v=k.editor;v.setCursor({line:r.line,ch:0}),v.scrollIntoView({from:{line:r.line,ch:0},to:{line:r.line,ch:0}},!0)}},100))}),u.createEl("span",{text:` (${r.key})`,cls:"block-properties-panel-backlinks-key"})}}}startEditingValue(e,s,t,n){e.empty();let o=e.createEl("input",{type:"text",value:n,cls:"block-properties-panel-edit-input"}),l=e.createEl("div",{cls:"block-properties-panel-dropdown"});this.populateValueDropdown(l,t,o),o.focus(),o.select(),o.addEventListener("input",()=>{this.populateValueDropdown(l,t,o)});let a=async()=>{let c=o.value.trim();await this.updateProperty(s,t,c)};o.addEventListener("blur",()=>{setTimeout(()=>{e.contains(document.activeElement)||a()},150)}),o.addEventListener("keydown",c=>{c.key==="Enter"?(c.preventDefault(),a()):c.key==="Escape"&&this.renderPanel()})}populateValueDropdown(e,s,t){e.empty();let n=this.plugin.getSuggest();if(!n){e.hide();return}let o=n.getValuesForKey(s),l=t.value.toLowerCase(),a=Array.from(o.entries()).filter(([c])=>c.toLowerCase().includes(l)).sort((c,p)=>p[1]-c[1]).slice(0,5);if(a.length===0){e.hide();return}e.show();for(let[c,p]of a){let r=e.createEl("div",{cls:"block-properties-panel-dropdown-item"});r.createEl("span",{text:c}),r.createEl("span",{text:`${p}`,cls:"block-properties-panel-dropdown-count"}),r.addEventListener("click",()=>{t.value=c,t.focus(),e.hide()})}}startAddingProperty(e,s,t){t.remove();let n=e.createEl("div",{cls:"block-properties-panel-prop block-properties-panel-new-prop"}),o=n.createEl("input",{type:"text",placeholder:"key",cls:"block-properties-panel-edit-input block-properties-panel-key-input"});n.createEl("span",{text:":"});let l=n.createEl("input",{type:"text",placeholder:"value",cls:"block-properties-panel-edit-input"}),a=n.createEl("button",{text:"\u2713",cls:"block-properties-panel-save-btn"}),c=n.createEl("button",{text:"\xD7",cls:"block-properties-panel-cancel-btn"});o.focus();let p=n.createEl("div",{cls:"block-properties-panel-dropdown block-properties-panel-key-dropdown"});o.addEventListener("input",()=>{this.populateKeyDropdown(p,o,l)}),a.addEventListener("click",async()=>{let r=o.value.trim(),u=l.value.trim();r&&await this.addProperty(s,r,u)}),c.addEventListener("click",()=>{this.renderPanel()}),l.addEventListener("keydown",r=>{r.key==="Enter"?a.click():r.key==="Escape"&&c.click()}),o.addEventListener("keydown",r=>{r.key==="Escape"&&c.click()})}populateKeyDropdown(e,s,t){e.empty();let n=this.plugin.getSuggest();if(!n){e.hide();return}let o=n.getKeys(),l=s.value.toLowerCase(),a=Array.from(o.entries()).filter(([c])=>c.toLowerCase().includes(l)).sort((c,p)=>p[1]-c[1]).slice(0,5);if(a.length===0){e.hide();return}e.show();for(let[c,p]of a){let r=e.createEl("div",{cls:"block-properties-panel-dropdown-item"});r.createEl("span",{text:c}),r.createEl("span",{text:`${p}`,cls:"block-properties-panel-dropdown-count"}),r.addEventListener("click",()=>{s.value=c,t.focus(),e.hide()})}}async updateProperty(e,s,t){if(this.currentFile)try{let o=(await this.app.vault.read(this.currentFile)).split(`
`),l=o[e.line];if(!l)return;let c=e.properties.map(h=>h.key===s?{key:s,value:t}:h).map(h=>`${h.key}: ${h.value}`).join(", "),p=l.slice(0,e.propsStart),r=l.slice(e.propsEnd+1),u=`${p}[${c}]${r}`;o[e.line]=u,await this.app.vault.modify(this.currentFile,o.join(`
`)),this.renderPanel()}catch(n){new x.Notice("Failed to update property")}}async addProperty(e,s,t){if(this.currentFile){if(e.properties.find(n=>n.key===s)){await this.updateProperty(e,s,t);return}try{let o=(await this.app.vault.read(this.currentFile)).split(`
`),l=o[e.line];if(!l)return;let c=[...e.properties,{key:s,value:t}].map(h=>`${h.key}: ${h.value}`).join(", "),p=l.slice(0,e.propsStart),r=l.slice(e.propsEnd+1),u=`${p}[${c}]${r}`;o[e.line]=u,await this.app.vault.modify(this.currentFile,o.join(`
`)),this.renderPanel()}catch(n){new x.Notice("Failed to add property")}}}async deleteProperty(e,s){if(this.currentFile)try{let n=(await this.app.vault.read(this.currentFile)).split(`
`),o=n[e.line];if(!o)return;let l=e.properties.filter(a=>a.key!==s);if(l.length===0){let a=o.slice(0,e.blockStart),c=o.slice(e.propsEnd+1),p=o.slice(e.blockStart).match(/^\^[\w-]+/),r=`${a}${(p==null?void 0:p[0])||""}${c}`;n[e.line]=r}else{let a=l.map(u=>`${u.key}: ${u.value}`).join(", "),c=o.slice(0,e.propsStart),p=o.slice(e.propsEnd+1),r=`${c}[${a}]${p}`;n[e.line]=r}await this.app.vault.modify(this.currentFile,n.join(`
`)),this.renderPanel()}catch(t){new x.Notice("Failed to delete property")}}};var w=require("obsidian");var N=class extends w.Modal{constructor(i,e){super(i),this.onSubmit=e}onOpen(){let{contentEl:i}=this;i.addClass("block-properties-query-modal"),i.createEl("h2",{text:"Query Block Properties"});let e="",s="";new w.Setting(i).setName("Property key").setDesc('e.g. "status", "priority", "version"').addText(t=>t.setPlaceholder("status").onChange(n=>{e=n})),new w.Setting(i).setName("Property value (optional)").setDesc("Leave empty to find all blocks with this key").addText(t=>t.setPlaceholder("draft").onChange(n=>{s=n})),new w.Setting(i).addButton(t=>t.setButtonText("Search").setCta().onClick(()=>{this.close(),this.onSubmit(e,s)}))}onClose(){let{contentEl:i}=this;i.empty()}},A=class extends w.Modal{constructor(i,e,s){super(i),this.results=e,this.query=s}onOpen(){let{contentEl:i}=this;i.addClass("block-properties-results-modal");let e=this.query.value?`${this.query.key}: ${this.query.value}`:this.query.key;if(i.createEl("h2",{text:`Results for "${e}"`}),i.createEl("p",{text:`Found ${this.results.length} block(s)`,cls:"block-properties-results-count"}),this.results.length===0){i.createEl("p",{text:"No blocks found with matching properties.",cls:"block-properties-no-results"});return}let s=i.createEl("div",{cls:"block-properties-results-list"});for(let t of this.results){let n=s.createEl("div",{cls:"block-properties-result-item"});n.createEl("div",{cls:"block-properties-result-header"}).createEl("a",{text:`${t.file.basename} \u2192 ^${t.blockId}`,cls:"block-properties-result-link"}).addEventListener("click",async c=>{c.preventDefault(),this.close(),await this.app.workspace.getLeaf().openFile(t.file);let r=this.app.workspace.getActiveViewOfType(w.MarkdownView);if(r){let u=r.editor;u.setCursor({line:t.line,ch:0}),u.scrollIntoView({from:{line:t.line,ch:0},to:{line:t.line,ch:0}},!0)}});let a=n.createEl("div",{cls:"block-properties-result-props"});for(let c of t.properties){let p=c.key===this.query.key&&(!this.query.value||c.value===this.query.value);a.createEl("span",{text:`${c.key}: ${c.value}`,cls:`block-properties-result-prop ${p?"is-match":""}`})}t.context&&n.createEl("div",{text:t.context,cls:"block-properties-result-context"})}}onClose(){let{contentEl:i}=this;i.empty()}};async function ie(d,i,e){let s=[],t=d.vault.getMarkdownFiles();for(let n of t){let l=(await d.vault.cachedRead(n)).split(`
`);for(let a=0;a<l.length;a++){let c=l[a];if(!c)continue;let p=b(c);for(let r of p)r.properties.find(h=>h.key===i&&(!e||h.value===e))&&s.push({file:n,line:a,blockId:r.blockId,properties:r.properties,context:c.slice(0,r.from).trim().slice(0,60)})}}return s}var y=require("obsidian");var S=require("obsidian"),D=class extends S.Modal{constructor(i,e,s){super(i),this.isNew=!e,this.template=e?{...e,properties:e.properties.map(t=>({...t}))}:{name:"",properties:[{key:"",value:""}]},this.onSave=s}onOpen(){let{contentEl:i}=this;i.addClass("block-properties-template-modal"),i.createEl("h2",{text:this.isNew?"Create Template":"Edit Template"}),new S.Setting(i).setName("Template name").setDesc('Used in "preset: name" syntax').addText(s=>s.setPlaceholder("task").setValue(this.template.name).onChange(t=>{this.template.name=t.trim().toLowerCase().replace(/\s+/g,"-")})),i.createEl("h4",{text:"Properties"});let e=i.createEl("div",{cls:"block-properties-template-props"});this.renderProperties(e),new S.Setting(i).addButton(s=>s.setButtonText("Cancel").onClick(()=>this.close())).addButton(s=>s.setButtonText("Save").setCta().onClick(()=>{if(!this.template.name){new S.Notice("Template name is required");return}if(this.template.properties=this.template.properties.filter(t=>t.key.trim()),this.template.properties.length===0){new S.Notice("At least one property is required");return}this.onSave(this.template),this.close()}))}renderProperties(i){i.empty();for(let s=0;s<this.template.properties.length;s++){let t=this.template.properties[s];if(!t)continue;let n=i.createEl("div",{cls:"block-properties-template-prop-row"});n.createEl("input",{type:"text",placeholder:"key",value:t.key,cls:"block-properties-template-input"}).addEventListener("input",c=>{t.key=c.target.value}),n.createEl("span",{text:":"}),n.createEl("input",{type:"text",placeholder:"default value",value:t.value,cls:"block-properties-template-input"}).addEventListener("input",c=>{t.value=c.target.value});let a=n.createEl("button",{cls:"block-properties-template-delete-btn"});a.innerHTML="&times;",a.addEventListener("click",()=>{this.template.properties.splice(s,1),this.template.properties.length===0&&this.template.properties.push({key:"",value:""}),this.renderProperties(i)})}i.createEl("button",{text:"+ Add property",cls:"block-properties-template-add-btn"}).addEventListener("click",()=>{this.template.properties.push({key:"",value:""}),this.renderProperties(i)})}onClose(){this.contentEl.empty()}},O=class extends S.Modal{constructor(i,e,s){super(i),this.templates=e,this.onSelect=s}onOpen(){let{contentEl:i}=this;if(i.createEl("h2",{text:"Select Template"}),this.templates.length===0){i.createEl("p",{text:"No templates defined. Add templates in settings.",cls:"block-properties-no-templates"});return}let e=i.createEl("div",{cls:"block-properties-template-list"});for(let s of this.templates){let t=e.createEl("div",{cls:"block-properties-template-item"});t.createEl("div",{text:s.name,cls:"block-properties-template-name"}),t.createEl("div",{text:s.properties.map(n=>`${n.key}: ${n.value||"..."}`).join(", "),cls:"block-properties-template-preview"}),t.addEventListener("click",()=>{this.onSelect(s),this.close()})}}onClose(){this.contentEl.empty()}};var oe=require("obsidian"),H=class extends y.PluginSettingTab{constructor(i,e){super(i,e),this.plugin=e}display(){let{containerEl:i}=this;i.empty(),i.createEl("h2",{text:"Block Properties Settings"}),new y.Setting(i).setName("Display mode").setDesc("How to display block properties in the editor").addDropdown(t=>t.addOption("inline","Inline (dimmed text)").addOption("badge","Badge (compact icon)").setValue(this.plugin.settings.displayMode).onChange(async n=>{this.plugin.settings.displayMode=n,await this.plugin.saveSettings(),this.plugin.refreshEditorExtension()})),new y.Setting(i).setName("Property color").setDesc("Color used to display block properties").addText(t=>t.setPlaceholder("#888888").setValue(this.plugin.settings.propertyColor).onChange(async n=>{this.plugin.settings.propertyColor=n||"#888888",await this.plugin.saveSettings(),this.plugin.updateStyles()})),new y.Setting(i).setName("Opacity").setDesc("Opacity of block properties (0.1 - 1.0)").addSlider(t=>t.setLimits(.1,1,.1).setValue(this.plugin.settings.opacity).setDynamicTooltip().onChange(async n=>{this.plugin.settings.opacity=n,await this.plugin.saveSettings(),this.plugin.updateStyles()})),i.createEl("h3",{text:"Linked Properties"}),new y.Setting(i).setName("Enable linked properties").setDesc("Allow property values to contain links to notes ([[Note]]) and blocks (^block-id). Cmd/Ctrl+click to navigate.").addToggle(t=>t.setValue(this.plugin.settings.enableLinkedProperties).onChange(async n=>{this.plugin.settings.enableLinkedProperties=n,await this.plugin.saveSettings(),this.plugin.refreshEditorExtension()})),new y.Setting(i).setName("Show backlinks in panel").setDesc('Display a "Referenced by" section in the property panel showing blocks that link to this block').addToggle(t=>t.setValue(this.plugin.settings.showBacklinksInPanel).onChange(async n=>{this.plugin.settings.showBacklinksInPanel=n,await this.plugin.saveSettings()})),i.createEl("h3",{text:"Conditional Styling"}),new y.Setting(i).setName("Enable conditional styling").setDesc("Add CSS classes based on property values (e.g., bp-status-done). This enables visual styling of blocks based on their properties.").addToggle(t=>t.setValue(this.plugin.settings.enableConditionalStyling).onChange(async n=>{this.plugin.settings.enableConditionalStyling=n,await this.plugin.saveSettings(),this.plugin.updateStyles(),this.plugin.refreshEditorExtension()})),new y.Setting(i).setName("Styling target").setDesc("Apply styles to the property text only, or to the entire line").addDropdown(t=>t.addOption("property","Property only").addOption("line","Entire line").setValue(this.plugin.settings.stylingTarget).onChange(async n=>{this.plugin.settings.stylingTarget=n,await this.plugin.saveSettings(),this.plugin.refreshEditorExtension()})),new y.Setting(i).setName("Use preset styles").setDesc("Apply built-in visual styles for common properties (status: done = strikethrough, priority: high = red accent, etc.)").addToggle(t=>t.setValue(this.plugin.settings.usePresetStyles).onChange(async n=>{this.plugin.settings.usePresetStyles=n,await this.plugin.saveSettings(),this.plugin.updateStyles()}));let e=i.createEl("div",{cls:"block-properties-rules-container"});this.renderCustomRulesList(e),i.createEl("h3",{text:"Property Templates"}),new y.Setting(i).setName("Auto-expand presets").setDesc('Automatically expand "preset: name" to full template properties when selected from autocomplete').addToggle(t=>t.setValue(this.plugin.settings.autoExpandPresets).onChange(async n=>{this.plugin.settings.autoExpandPresets=n,await this.plugin.saveSettings()}));let s=i.createEl("div",{cls:"block-properties-templates-container"});this.renderTemplatesList(s)}renderTemplatesList(i){i.empty();for(let e=0;e<this.plugin.settings.templates.length;e++){let s=this.plugin.settings.templates[e];s&&this.renderTemplateItem(i,s,e)}new y.Setting(i).addButton(e=>e.setButtonText("Add template").setCta().onClick(()=>{this.openTemplateModal(null,s=>{this.plugin.settings.templates.push(s),this.plugin.saveSettings(),this.renderTemplatesList(i)})}))}renderTemplateItem(i,e,s){new y.Setting(i).setName(e.name).setDesc(e.properties.map(t=>`${t.key}: ${t.value||"(empty)"}`).join(", ")).addButton(t=>t.setIcon("pencil").setTooltip("Edit").onClick(()=>{this.openTemplateModal(e,n=>{this.plugin.settings.templates[s]=n,this.plugin.saveSettings(),this.renderTemplatesList(i)})})).addButton(t=>t.setIcon("trash").setTooltip("Delete").onClick(async()=>{this.plugin.settings.templates.splice(s,1),await this.plugin.saveSettings(),this.renderTemplatesList(i)}))}openTemplateModal(i,e){new D(this.app,i,e).open()}renderCustomRulesList(i){i.empty();let e=this.plugin.settings.customStyleRules;if(e.length>0){let s=i.createEl("p",{cls:"setting-item-description",text:"Custom rules for applying CSS classes based on property values:"});s.style.marginBottom="8px"}for(let s=0;s<e.length;s++){let t=e[s];t&&this.renderRuleItem(i,t,s)}new y.Setting(i).setName("Add custom style rule").setDesc("Add a rule to apply a CSS class when a property matches a condition").addButton(s=>s.setButtonText("Add rule").onClick(()=>{this.openRuleModal(null,t=>{this.plugin.settings.customStyleRules.push(t),this.plugin.saveSettings(),this.plugin.refreshEditorExtension(),this.renderCustomRulesList(i)})}))}renderRuleItem(i,e,s){let t=e.value==="*"?"(any value)":e.value;new y.Setting(i).setName(`${e.key}: ${t}`).setDesc(`\u2192 ${e.className}`).addButton(n=>n.setIcon("pencil").setTooltip("Edit").onClick(()=>{this.openRuleModal(e,o=>{this.plugin.settings.customStyleRules[s]=o,this.plugin.saveSettings(),this.plugin.refreshEditorExtension(),this.renderRuleItem(i,o,s)})})).addButton(n=>n.setIcon("trash").setTooltip("Delete").onClick(async()=>{this.plugin.settings.customStyleRules.splice(s,1),await this.plugin.saveSettings(),this.plugin.refreshEditorExtension(),this.renderCustomRulesList(i)}))}openRuleModal(i,e){new G(this.app,i,e).open()}},G=class extends oe.Modal{constructor(i,e,s){super(i),this.existing=e,this.onSave=s}onOpen(){let{contentEl:i}=this;i.empty(),i.createEl("h2",{text:this.existing?"Edit Style Rule":"New Style Rule"}),new y.Setting(i).setName("Property key").setDesc('The property key to match (e.g., "status")').addText(e=>{var s;this.keyInput=e,e.setValue(((s=this.existing)==null?void 0:s.key)||""),e.inputEl.placeholder="status"}),new y.Setting(i).setName("Property value").setDesc('The value to match, or "*" to match any value').addText(e=>{var s;this.valueInput=e,e.setValue(((s=this.existing)==null?void 0:s.value)||""),e.inputEl.placeholder="done or *"}),new y.Setting(i).setName("CSS class").setDesc("The CSS class to apply when the rule matches").addText(e=>{var s;this.classInput=e,e.setValue(((s=this.existing)==null?void 0:s.className)||""),e.inputEl.placeholder="my-custom-class"}),new y.Setting(i).addButton(e=>e.setButtonText("Cancel").onClick(()=>this.close())).addButton(e=>e.setButtonText("Save").setCta().onClick(()=>{let s=this.keyInput.getValue().trim(),t=this.valueInput.getValue().trim(),n=this.classInput.getValue().trim();!s||!t||!n||(this.onSave({key:s,value:t,className:n}),this.close())}))}onClose(){this.contentEl.empty()}};var K=require("obsidian");var q=class extends K.EditorSuggest{constructor(e){super(e.app);this.cachedKeys=new Map;this.cachedValues=new Map;this.cachedBlockIds=new Map;this.lastCacheUpdate=0;this.CACHE_TTL=3e4;this.plugin=e}onTrigger(e,s,t){let n=s.getLine(e.line),o=n.slice(0,e.ch),l=n.slice(e.ch),a=o.lastIndexOf("[");if(a===-1)return null;let c=o.slice(a+1);if(c.includes("]")||!n.slice(0,a).match(/\^[\w-]+\s*$/))return null;let r=c.lastIndexOf(","),u=c.lastIndexOf(":"),h,g;return u>r?(h=a+1+u+1,g=c.slice(u+1).trim()):(h=a+1+(r===-1?0:r+1),g=r===-1?c.trim():c.slice(r+1).trim()),{start:{line:e.line,ch:h},end:e,query:g}}async getSuggestions(e){await this.updateCache();let t=e.editor.getLine(e.start.line).slice(0,e.end.ch),n=t.lastIndexOf("["),o=t.slice(n+1),l=o.lastIndexOf(","),a=o.lastIndexOf(":"),c=e.query.toLowerCase();if(a>l){let p=l===-1?0:l+1,r=o.slice(p,a).trim(),u=o.slice(a+1),h=this.detectLinkContext(u);if((h==null?void 0:h.type)==="note")return this.getNoteSuggestions(h.query);if((h==null?void 0:h.type)==="block")return this.getBlockSuggestions(h.query);if(r==="preset")return this.plugin.settings.templates.filter(m=>m.name.toLowerCase().includes(c)).map(m=>({type:"template",text:m.name,count:m.properties.length,template:m}));let g=this.cachedValues.get(r)||new Map;return Array.from(g.entries()).filter(([m])=>m.toLowerCase().includes(c)).map(([m,f])=>({type:"value",text:m,count:f})).sort((m,f)=>f.count-m.count).slice(0,10)}else{let p=Array.from(this.cachedKeys.entries()).filter(([r])=>r.toLowerCase().includes(c)).map(([r,u])=>({type:"key",text:r,count:u})).sort((r,u)=>u.count-r.count).slice(0,10);return"preset".includes(c)&&this.plugin.settings.templates.length>0&&!p.find(r=>r.text==="preset")&&p.unshift({type:"key",text:"preset",count:this.plugin.settings.templates.length}),p}}detectLinkContext(e){let s=e.lastIndexOf("[[");if(s!==-1){let n=e.slice(s+2);if(!n.includes("]]"))return{type:"note",query:n.trim()}}let t=e.lastIndexOf("^");if(t!==-1){let n=e.slice(t+1);if(/^[\w-]*$/.test(n))return{type:"block",query:n}}return null}getNoteSuggestions(e){let s=this.app.vault.getMarkdownFiles(),t=e.toLowerCase();return s.filter(n=>n.basename.toLowerCase().includes(t)).slice(0,10).map(n=>({type:"note-link",text:n.basename,count:0,filePath:n.path}))}getBlockSuggestions(e){let s=e.toLowerCase();return Array.from(this.cachedBlockIds.entries()).filter(([t])=>t.toLowerCase().includes(s)).slice(0,10).map(([t,n])=>{let o=this.app.vault.getAbstractFileByPath(n),l=o instanceof K.TFile?o.basename:n;return{type:"block-ref",text:t,count:0,filePath:l}})}renderSuggestion(e,s){s.addClass("block-properties-suggestion"),s.createEl("span",{text:e.text,cls:"block-properties-suggestion-text"});let t=s.createEl("span",{cls:"block-properties-suggestion-meta"}),n;switch(e.type){case"template":n="template";break;case"key":n="key";break;case"note-link":n="note";break;case"block-ref":n="block";break;default:n="value"}t.createEl("span",{text:n,cls:`block-properties-suggestion-type block-properties-suggestion-type-${e.type}`}),e.type==="note-link"||e.type==="block-ref"?e.filePath&&t.createEl("span",{text:e.filePath,cls:"block-properties-suggestion-path"}):t.createEl("span",{text:`${e.count}`,cls:"block-properties-suggestion-count"}),e.type==="template"&&e.template&&s.createEl("div",{text:e.template.properties.map(o=>`${o.key}: ${o.value||"..."}`).join(", "),cls:"block-properties-suggestion-preview"})}selectSuggestion(e,s){if(!this.context)return;let{editor:t,start:n,end:o}=this.context,l=t.getLine(n.line);if(e.type==="template"&&e.template&&this.plugin.settings.autoExpandPresets){let r=l.lastIndexOf("[",n.ch),u=l.indexOf("]",o.ch);if(r!==-1&&u!==-1){let h=e.template.properties.map(m=>`${m.key}: ${m.value}`).join(", ");t.replaceRange(`[${h}]`,{line:n.line,ch:r},{line:n.line,ch:u+1});let g=r+h.length+2;t.setCursor({line:n.line,ch:g});return}}let a=e.text,c=n;if(e.type==="key")a=e.text+": ";else if(e.type==="note-link"){let u=l.slice(0,o.ch).lastIndexOf("[[");u!==-1&&(c={line:n.line,ch:u},a=`[[${e.text}]]`)}else if(e.type==="block-ref"){let u=l.slice(0,o.ch).lastIndexOf("^");u!==-1&&(c={line:n.line,ch:u},a=`^${e.text}`)}t.replaceRange(a,c,o);let p=c.ch+a.length;t.setCursor({line:n.line,ch:p})}async updateCache(){let e=Date.now();if(e-this.lastCacheUpdate<this.CACHE_TTL)return;this.cachedKeys.clear(),this.cachedValues.clear(),this.cachedBlockIds.clear();let s=this.app.vault.getMarkdownFiles();for(let t of s)try{let o=(await this.app.vault.cachedRead(t)).split(`
`);for(let l of o){let a=b(l);for(let p of a){this.cachedBlockIds.has(p.blockId)||this.cachedBlockIds.set(p.blockId,t.path);for(let r of p.properties){this.cachedKeys.set(r.key,(this.cachedKeys.get(r.key)||0)+1),this.cachedValues.has(r.key)||this.cachedValues.set(r.key,new Map);let u=this.cachedValues.get(r.key);u.set(r.value,(u.get(r.value)||0)+1)}}let c=l.matchAll(/\^([\w-]+)(?!\s*\[)/g);for(let p of c){let r=p[1];r&&!this.cachedBlockIds.has(r)&&this.cachedBlockIds.set(r,t.path)}}}catch(n){}this.lastCacheUpdate=e}getKeys(){return this.cachedKeys}getValuesForKey(e){return this.cachedValues.get(e)||new Map}async refreshCache(){this.lastCacheUpdate=0,await this.updateCache()}};var re={displayMode:"inline",propertyColor:"#888888",opacity:.6,templates:[{name:"task",properties:[{key:"status",value:"todo"},{key:"priority",value:"medium"},{key:"assignee",value:""}]}],autoExpandPresets:!0,enableLinkedProperties:!0,showBacklinksInPanel:!0,enableConditionalStyling:!0,stylingTarget:"property",usePresetStyles:!0,customStyleRules:[]};var F=require("obsidian");var j=class extends F.Events{constructor(e){super();this.index=new Map;this.fileEventRefs=[];this.isBuilding=!1;this.debounceTimer=null;this.DEBOUNCE_MS=500;this.app=e}async buildIndex(){if(this.isBuilding)return;this.isBuilding=!0,this.index.clear();let e=this.app.vault.getMarkdownFiles();for(let s of e)await this.indexFile(s);this.isBuilding=!1,this.trigger("index-updated")}async indexFile(e){this.removeFileFromIndex(e.path);let t=(await this.app.vault.cachedRead(e)).split(`
`);for(let n=0;n<t.length;n++){let o=t[n];if(!o)continue;let l=b(o);for(let a of l)for(let c of a.properties){let p=R(c.value);for(let r of p.links){let u=r.type==="note"?this.normalizeNotePath(r.target):`^${r.target}`,h={sourceFile:e.path,sourceBlockId:a.blockId,key:c.key,line:n},g=this.index.get(u);g?g.push(h):this.index.set(u,[h])}}}}removeFileFromIndex(e){for(let[s,t]of this.index.entries()){let n=t.filter(o=>o.sourceFile!==e);n.length===0?this.index.delete(s):this.index.set(s,n)}}normalizeNotePath(e){return e.endsWith(".md")?e:`${e}.md`}getBacklinksForBlock(e){return this.index.get(`^${e}`)||[]}getBacklinksForNote(e){return this.index.get(this.normalizeNotePath(e))||[]}async getBacklinksForFile(e){let s=new Map,t=this.getBacklinksForNote(e.path);t.length>0&&s.set(e.basename,t);let n=await this.app.vault.cachedRead(e),o=b(n);for(let l of o){let a=this.getBacklinksForBlock(l.blockId);a.length>0&&s.set(`^${l.blockId}`,a)}return s}registerFileEvents(){this.fileEventRefs.push(this.app.vault.on("modify",e=>{e instanceof F.TFile&&e.extension==="md"&&this.debouncedIndexFile(e)}),this.app.vault.on("delete",e=>{e instanceof F.TFile&&(this.removeFileFromIndex(e.path),this.trigger("index-updated"))}),this.app.vault.on("rename",(e,s)=>{e instanceof F.TFile&&e.extension==="md"&&(this.removeFileFromIndex(s),this.debouncedIndexFile(e))}))}debouncedIndexFile(e){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(async()=>{await this.indexFile(e),this.trigger("index-updated"),this.debounceTimer=null},this.DEBOUNCE_MS)}unregisterFileEvents(){for(let e of this.fileEventRefs)this.app.vault.offref(e);this.fileEventRefs=[],this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null)}getStats(){let e=0;for(let s of this.index.values())e+=s.length;return{targets:this.index.size,totalBacklinks:e}}};var _=class extends le.Plugin{constructor(){super(...arguments);this.styleEl=null;this.editorExtension=[];this.suggest=null;this.backlinkIndex=null;this.readingTooltip=null}async onload(){await this.loadSettings(),this.editorExtension=J(this.settings.displayMode,this.settings,this.settings.enableLinkedProperties?this.app:void 0),this.registerEditorExtension(this.editorExtension),this.registerView(I,e=>new $(e,this)),this.suggest=new q(this),this.registerEditorSuggest(this.suggest),this.addSettingTab(new H(this.app,this)),this.settings.enableLinkedProperties&&(this.backlinkIndex=new j(this.app),this.backlinkIndex.registerFileEvents(),this.app.workspace.onLayoutReady(()=>{var e;(e=this.backlinkIndex)==null||e.buildIndex()})),this.addCommand({id:"insert-block-property",name:"Insert block property",editorCallback:(e,s)=>{let t=e.getCursor(),n=e.getLine(t.line);if(n.includes("^")){let o=n.match(/\^([\w-]+)(?:\s*\[([^\]]*)\])?/);if(o){let l=o[1],a=o[2]||"",c=a?`${a}, key: value`:"key: value",p=`^${l} [${c}]`,r=n.indexOf("^");e.replaceRange(p,{line:t.line,ch:r},{line:t.line,ch:n.length})}}else e.replaceRange(" ^block-id [key: value]",{line:t.line,ch:n.length})}}),this.addCommand({id:"insert-template",name:"Insert property template",editorCallback:(e,s)=>{new O(this.app,this.settings.templates,t=>{let n=e.getCursor(),o=e.getLine(n.line),l=this.generateBlockId(),a=t.properties.map(p=>`${p.key}: ${p.value}`).join(", "),c=` ^${l} [${a}]`;e.replaceRange(c,{line:n.line,ch:o.length})}).open()}}),this.addCommand({id:"query-block-properties",name:"Query block properties",callback:()=>{new N(this.app,async(e,s)=>{if(!e)return;let t=await ie(this.app,e,s||void 0);new A(this.app,t,{key:e,value:s}).open()}).open()}}),this.addCommand({id:"open-property-panel",name:"Open property panel",callback:()=>{this.activatePanel()}}),this.registerMarkdownPostProcessor(this.postProcessor.bind(this)),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.updatePanel()})),this.registerEvent(this.app.workspace.on("editor-change",()=>{this.updatePanel()})),this.updateStyles()}async activatePanel(){let s=this.app.workspace.getLeavesOfType(I)[0];if(s){this.app.workspace.revealLeaf(s);return}let t=this.app.workspace.getRightLeaf(!1);t&&(await t.setViewState({type:I,active:!0}),this.app.workspace.revealLeaf(t))}updatePanel(){let e=this.app.workspace.getLeavesOfType(I);for(let s of e){let t=s.view,n=this.app.workspace.getActiveFile();t.updateForFile(n)}}postProcessor(e,s){let t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[],o;for(;o=t.nextNode();){let l=o.textContent||"",a=b(l);a.length>0&&n.push({node:o,props:a})}for(let{node:l,props:a}of n.reverse()){let c=l.textContent||"";for(let p of a.reverse()){let u=c.slice(p.from,p.to).indexOf("[");if(u===-1)continue;let h=c.slice(0,p.from+u),g=c.slice(p.from+u,p.to),m=c.slice(p.to),f=L(p.properties,this.settings),k=document.createElement("span");k.className=["block-property","block-property-reading",...f].join(" "),k.textContent=g,k.setAttribute("data-block-id",p.blockId),k.setAttribute("data-properties",JSON.stringify(p.properties)),k.addEventListener("mouseenter",P=>{this.showReadingTooltip(P.target,p)}),k.addEventListener("mouseleave",()=>{this.hideReadingTooltip()});let v=l.parentNode;if(v){let P=document.createTextNode(h),T=document.createTextNode(m);if(v.insertBefore(P,l),v.insertBefore(k,l),v.insertBefore(T,l),v.removeChild(l),this.settings.enableConditionalStyling&&this.settings.stylingTarget==="line"&&f.length>0){let C=k.closest("p, li, div.markdown-preview-sizer > div");C&&C.classList.add("bp-styled-line",...f)}}}}}showReadingTooltip(e,s){this.hideReadingTooltip();let t=document.createElement("div");t.className="block-properties-tooltip block-properties-reading-tooltip";let n=document.createElement("div");n.className="block-properties-tooltip-header",n.textContent=`^${s.blockId}`,t.appendChild(n);let o=document.createElement("div");o.className="block-properties-tooltip-list";for(let a of s.properties){let c=document.createElement("div");c.className="block-properties-tooltip-item";let p=document.createElement("span");p.className="block-properties-tooltip-key",p.textContent=a.key;let r=document.createElement("span");r.className="block-properties-tooltip-value",r.textContent=a.value,c.appendChild(p),c.appendChild(r),o.appendChild(c)}t.appendChild(o);let l=e.getBoundingClientRect();t.style.position="fixed",t.style.left=`${l.left}px`,t.style.top=`${l.top-8}px`,t.style.transform="translateY(-100%)",t.style.zIndex="1000",document.body.appendChild(t),this.readingTooltip=t}hideReadingTooltip(){this.readingTooltip&&(this.readingTooltip.remove(),this.readingTooltip=null)}onunload(){var e;this.styleEl&&this.styleEl.remove(),(e=this.backlinkIndex)==null||e.unregisterFileEvents()}getBacklinkIndex(){return this.backlinkIndex}async loadSettings(){this.settings=Object.assign({},re,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}updateStyles(){this.styleEl||(this.styleEl=document.createElement("style"),this.styleEl.id="block-properties-styles",document.head.appendChild(this.styleEl)),this.styleEl.textContent=`
			.block-property {
				color: ${this.settings.propertyColor};
				opacity: ${this.settings.opacity};
				font-size: 0.9em;
			}
		`,document.body.classList.toggle("bp-use-presets",this.settings.enableConditionalStyling&&this.settings.usePresetStyles)}refreshEditorExtension(){let e=J(this.settings.displayMode,this.settings,this.settings.enableLinkedProperties?this.app:void 0);this.editorExtension.length=0,this.editorExtension.push(...e),this.app.workspace.updateOptions()}getSuggest(){return this.suggest}generateBlockId(){let e="abcdefghijklmnopqrstuvwxyz0123456789",s="";for(let t=0;t<6;t++)s+=e.charAt(Math.floor(Math.random()*e.length));return s}};
