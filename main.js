/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var L=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var W=(d,r)=>{for(var e in r)L(d,e,{get:r[e],enumerable:!0})},Q=(d,r,e,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of _(r))!K.call(d,t)&&t!==e&&L(d,t,{get:()=>r[t],enumerable:!(o=H(r,t))||o.enumerable});return d};var U=d=>Q(L({},"__esModule",{value:!0}),d);var z={};W(z,{default:()=>I});module.exports=U(z);var A=require("obsidian");var D=require("@codemirror/state"),y=require("@codemirror/view");var O=/\^([\w-]+)\s*\[([^\]]+)\]/g;function f(d,r=0){let e=[],o;for(O.lastIndex=0;(o=O.exec(d))!==null;){let t=o[1],s=o[2];if(!t||!s)continue;let l=J(s);e.push({blockId:t,properties:l,from:r+o.index,to:r+o.index+o[0].length})}return e}function J(d){let r=[],e=d.split(",");for(let o of e){let t=o.indexOf(":");if(t===-1)continue;let s=o.slice(0,t).trim(),l=o.slice(t+1).trim();s&&r.push({key:s,value:l})}return r}var j=y.Decoration.mark({class:"block-property"}),N=class extends y.WidgetType{constructor(e,o){super();this.blockId=e;this.properties=o}toDOM(){let e=document.createElement("span");e.className="block-property-badge",e.setAttribute("data-block-id",this.blockId),e.setAttribute("data-properties",JSON.stringify(this.properties));let o=this.properties.length;return e.textContent=`${o}`,e.title=this.properties.map(t=>`${t.key}: ${t.value}`).join(", "),e}eq(e){return this.blockId===e.blockId&&JSON.stringify(this.properties)===JSON.stringify(e.properties)}};function G(d){class r{constructor(o){this.decorations=this.buildDecorations(o)}update(o){(o.docChanged||o.viewportChanged)&&(this.decorations=this.buildDecorations(o.view))}destroy(){}buildDecorations(o){let t=new D.RangeSetBuilder;for(let{from:s,to:l}of o.visibleRanges){let p=o.state.doc.sliceString(s,l),c=f(p,s);for(let i of c){let n=o.state.doc.sliceString(i.from,i.to).indexOf("[");if(n!==-1){let h=i.from+n,u=i.to;if(d==="badge"){let m=new N(i.blockId,i.properties);t.add(h,u,y.Decoration.replace({widget:m}))}else t.add(h,u,j)}}}return t.finish()}}return y.ViewPlugin.fromClass(r,{decorations:e=>e.decorations})}var Y=(0,y.hoverTooltip)((d,r)=>{let e=d.state.doc.lineAt(r),o=e.text,t=e.from,s=f(o,t);for(let l of s){let c=d.state.doc.sliceString(l.from,l.to).indexOf("[");if(c!==-1){let i=l.from+c,a=l.to;if(r>=i&&r<=a)return{pos:i,above:!0,create(){let n=document.createElement("div");n.className="block-properties-tooltip";let h=document.createElement("div");h.className="block-properties-tooltip-header",h.textContent=`^${l.blockId}`,n.appendChild(h);let u=document.createElement("div");u.className="block-properties-tooltip-list";for(let m of l.properties){let x=document.createElement("div");x.className="block-properties-tooltip-item";let k=document.createElement("span");k.className="block-properties-tooltip-key",k.textContent=m.key;let g=document.createElement("span");g.className="block-properties-tooltip-value",g.textContent=m.value,x.appendChild(k),x.appendChild(g),u.appendChild(x)}return n.appendChild(u),{dom:n}}}}}return null});function V(d){return[G(d),Y]}var w=require("obsidian");var v="block-properties-panel",P=class extends w.ItemView{constructor(e,o){super(e);this.currentFile=null;this.plugin=o}getViewType(){return v}getDisplayText(){return"Block Properties"}getIcon(){return"tag"}async onOpen(){this.renderPanel()}async onClose(){}async updateForFile(e){this.currentFile=e,this.renderPanel()}async renderPanel(){let{contentEl:e}=this;e.empty(),e.addClass("block-properties-panel");let o=e.createEl("div",{cls:"block-properties-panel-header"});if(!this.currentFile){o.createEl("h4",{text:"Block Properties"}),e.createEl("p",{text:"No file open",cls:"block-properties-panel-empty"});return}o.createEl("h4",{text:this.currentFile.basename});let t=await this.app.vault.cachedRead(this.currentFile),s=this.extractBlocks(t);if(s.length===0){e.createEl("p",{text:"No block properties found",cls:"block-properties-panel-empty"});return}let l=e.createEl("p",{cls:"block-properties-panel-count"});l.textContent=`${s.length} block(s) with properties`;let p=e.createEl("div",{cls:"block-properties-panel-list"});for(let n of s){let h=p.createEl("div",{cls:"block-properties-panel-item"}),u=h.createEl("div",{cls:"block-properties-panel-item-header"});u.createEl("a",{text:`^${n.blockId}`,cls:"block-properties-panel-link"}).addEventListener("click",()=>{this.navigateToBlock(n.line)}),n.context&&u.createEl("span",{text:n.context,cls:"block-properties-panel-context"});let x=h.createEl("div",{cls:"block-properties-panel-props"});for(let k of n.properties){let g=x.createEl("div",{cls:"block-properties-panel-prop"});g.createEl("span",{text:k.key,cls:"block-properties-panel-key"}),g.createEl("span",{text:k.value,cls:"block-properties-panel-value"})}}let c=e.createEl("div",{cls:"block-properties-panel-summary"});c.createEl("h5",{text:"Summary"});let i=this.countKeys(s),a=c.createEl("div",{cls:"block-properties-panel-summary-list"});for(let[n,h]of Object.entries(i)){let u=a.createEl("div",{cls:"block-properties-panel-summary-item"});u.createEl("span",{text:n,cls:"block-properties-panel-summary-key"}),u.createEl("span",{text:`${h}`,cls:"block-properties-panel-summary-count"})}}extractBlocks(e){let o=[],t=e.split(`
`);for(let s=0;s<t.length;s++){let l=t[s];if(!l)continue;let p=f(l);for(let c of p){let i=l.slice(0,c.from).trim().slice(0,40);o.push({blockId:c.blockId,properties:c.properties,line:s,context:i||"(start of line)"})}}return o}countKeys(e){let o={};for(let t of e)for(let s of t.properties)o[s.key]=(o[s.key]||0)+1;return o}navigateToBlock(e){let o=this.app.workspace.getActiveViewOfType(w.MarkdownView);if(o){let t=o.editor;t.setCursor({line:e,ch:0}),t.scrollIntoView({from:{line:e,ch:0},to:{line:e,ch:0}},!0),t.focus()}}};var b=require("obsidian");var C=class extends b.Modal{constructor(r,e){super(r),this.onSubmit=e}onOpen(){let{contentEl:r}=this;r.addClass("block-properties-query-modal"),r.createEl("h2",{text:"Query Block Properties"});let e="",o="";new b.Setting(r).setName("Property key").setDesc('e.g. "status", "priority", "version"').addText(t=>t.setPlaceholder("status").onChange(s=>{e=s})),new b.Setting(r).setName("Property value (optional)").setDesc("Leave empty to find all blocks with this key").addText(t=>t.setPlaceholder("draft").onChange(s=>{o=s})),new b.Setting(r).addButton(t=>t.setButtonText("Search").setCta().onClick(()=>{this.close(),this.onSubmit(e,o)}))}onClose(){let{contentEl:r}=this;r.empty()}},T=class extends b.Modal{constructor(r,e,o){super(r),this.results=e,this.query=o}onOpen(){let{contentEl:r}=this;r.addClass("block-properties-results-modal");let e=this.query.value?`${this.query.key}: ${this.query.value}`:this.query.key;if(r.createEl("h2",{text:`Results for "${e}"`}),r.createEl("p",{text:`Found ${this.results.length} block(s)`,cls:"block-properties-results-count"}),this.results.length===0){r.createEl("p",{text:"No blocks found with matching properties.",cls:"block-properties-no-results"});return}let o=r.createEl("div",{cls:"block-properties-results-list"});for(let t of this.results){let s=o.createEl("div",{cls:"block-properties-result-item"});s.createEl("div",{cls:"block-properties-result-header"}).createEl("a",{text:`${t.file.basename} \u2192 ^${t.blockId}`,cls:"block-properties-result-link"}).addEventListener("click",async i=>{i.preventDefault(),this.close(),await this.app.workspace.getLeaf().openFile(t.file);let n=this.app.workspace.getActiveViewOfType(b.MarkdownView);if(n){let h=n.editor;h.setCursor({line:t.line,ch:0}),h.scrollIntoView({from:{line:t.line,ch:0},to:{line:t.line,ch:0}},!0)}});let c=s.createEl("div",{cls:"block-properties-result-props"});for(let i of t.properties){let a=i.key===this.query.key&&(!this.query.value||i.value===this.query.value);c.createEl("span",{text:`${i.key}: ${i.value}`,cls:`block-properties-result-prop ${a?"is-match":""}`})}t.context&&s.createEl("div",{text:t.context,cls:"block-properties-result-context"})}}onClose(){let{contentEl:r}=this;r.empty()}};async function R(d,r,e){let o=[],t=d.vault.getMarkdownFiles();for(let s of t){let p=(await d.vault.cachedRead(s)).split(`
`);for(let c=0;c<p.length;c++){let i=p[c];if(!i)continue;let a=f(i);for(let n of a)n.properties.find(u=>u.key===r&&(!e||u.value===e))&&o.push({file:s,line:c,blockId:n.blockId,properties:n.properties,context:i.slice(0,n.from).trim().slice(0,60)})}}return o}var E=require("obsidian"),S=class extends E.PluginSettingTab{constructor(r,e){super(r,e),this.plugin=e}display(){let{containerEl:r}=this;r.empty(),r.createEl("h2",{text:"Block Properties Settings"}),new E.Setting(r).setName("Display mode").setDesc("How to display block properties in the editor").addDropdown(e=>e.addOption("inline","Inline (dimmed text)").addOption("badge","Badge (compact icon)").setValue(this.plugin.settings.displayMode).onChange(async o=>{this.plugin.settings.displayMode=o,await this.plugin.saveSettings(),this.plugin.refreshEditorExtension()})),new E.Setting(r).setName("Property color").setDesc("Color used to display block properties").addText(e=>e.setPlaceholder("#888888").setValue(this.plugin.settings.propertyColor).onChange(async o=>{this.plugin.settings.propertyColor=o||"#888888",await this.plugin.saveSettings(),this.plugin.updateStyles()})),new E.Setting(r).setName("Opacity").setDesc("Opacity of block properties (0.1 - 1.0)").addSlider(e=>e.setLimits(.1,1,.1).setValue(this.plugin.settings.opacity).setDynamicTooltip().onChange(async o=>{this.plugin.settings.opacity=o,await this.plugin.saveSettings(),this.plugin.updateStyles()}))}};var F=require("obsidian");var B=class extends F.EditorSuggest{constructor(e){super(e.app);this.cachedKeys=new Map;this.cachedValues=new Map;this.lastCacheUpdate=0;this.CACHE_TTL=3e4;this.plugin=e}onTrigger(e,o,t){let s=o.getLine(e.line),l=s.slice(0,e.ch),p=s.slice(e.ch),c=l.lastIndexOf("[");if(c===-1)return null;let i=l.slice(c+1);if(i.includes("]")||!s.slice(0,c).match(/\^[\w-]+\s*$/))return null;let n=i.lastIndexOf(","),h=i.lastIndexOf(":"),u,m;return h>n?(u=c+1+h+1,m=i.slice(h+1).trim()):(u=c+1+(n===-1?0:n+1),m=n===-1?i.trim():i.slice(n+1).trim()),{start:{line:e.line,ch:u},end:e,query:m}}async getSuggestions(e){await this.updateCache();let t=e.editor.getLine(e.start.line).slice(0,e.end.ch),s=t.lastIndexOf("["),l=t.slice(s+1),p=l.lastIndexOf(","),c=l.lastIndexOf(":"),i=e.query.toLowerCase();if(c>p){let a=p===-1?0:p+1,n=l.slice(a,c).trim(),h=this.cachedValues.get(n)||new Map;return Array.from(h.entries()).filter(([u])=>u.toLowerCase().includes(i)).map(([u,m])=>({type:"value",text:u,count:m})).sort((u,m)=>m.count-u.count).slice(0,10)}else return Array.from(this.cachedKeys.entries()).filter(([a])=>a.toLowerCase().includes(i)).map(([a,n])=>({type:"key",text:a,count:n})).sort((a,n)=>n.count-a.count).slice(0,10)}renderSuggestion(e,o){o.addClass("block-properties-suggestion");let t=o.createEl("span",{text:e.text,cls:"block-properties-suggestion-text"}),s=o.createEl("span",{cls:"block-properties-suggestion-meta"});s.createEl("span",{text:e.type==="key"?"key":"value",cls:"block-properties-suggestion-type"}),s.createEl("span",{text:`${e.count}`,cls:"block-properties-suggestion-count"})}selectSuggestion(e,o){if(!this.context)return;let{editor:t,start:s,end:l}=this.context,p=e.text;e.type==="key"&&(p=e.text+": "),t.replaceRange(p,s,l);let c=s.ch+p.length;t.setCursor({line:s.line,ch:c})}async updateCache(){let e=Date.now();if(e-this.lastCacheUpdate<this.CACHE_TTL)return;this.cachedKeys.clear(),this.cachedValues.clear();let o=this.app.vault.getMarkdownFiles();for(let t of o)try{let l=(await this.app.vault.cachedRead(t)).split(`
`);for(let p of l){let c=f(p);for(let i of c)for(let a of i.properties){this.cachedKeys.set(a.key,(this.cachedKeys.get(a.key)||0)+1),this.cachedValues.has(a.key)||this.cachedValues.set(a.key,new Map);let n=this.cachedValues.get(a.key);n.set(a.value,(n.get(a.value)||0)+1)}}}catch(s){}this.lastCacheUpdate=e}};var $={displayMode:"inline",propertyColor:"#888888",opacity:.6};var I=class extends A.Plugin{constructor(){super(...arguments);this.styleEl=null;this.editorExtension=[];this.readingTooltip=null}async onload(){await this.loadSettings(),this.editorExtension=V(this.settings.displayMode),this.registerEditorExtension(this.editorExtension),this.registerView(v,e=>new P(e,this)),this.registerEditorSuggest(new B(this)),this.addSettingTab(new S(this.app,this)),this.addCommand({id:"insert-block-property",name:"Insert block property",editorCallback:(e,o)=>{let t=e.getCursor(),s=e.getLine(t.line);if(s.includes("^")){let l=s.match(/\^([\w-]+)(?:\s*\[([^\]]*)\])?/);if(l){let p=l[1],c=l[2]||"",i=c?`${c}, key: value`:"key: value",a=`^${p} [${i}]`,n=s.indexOf("^");e.replaceRange(a,{line:t.line,ch:n},{line:t.line,ch:s.length})}}else e.replaceRange(" ^block-id [key: value]",{line:t.line,ch:s.length})}}),this.addCommand({id:"query-block-properties",name:"Query block properties",callback:()=>{new C(this.app,async(e,o)=>{if(!e)return;let t=await R(this.app,e,o||void 0);new T(this.app,t,{key:e,value:o}).open()}).open()}}),this.addCommand({id:"open-property-panel",name:"Open property panel",callback:()=>{this.activatePanel()}}),this.registerMarkdownPostProcessor(this.postProcessor.bind(this)),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.updatePanel()})),this.registerEvent(this.app.workspace.on("editor-change",()=>{this.updatePanel()})),this.updateStyles()}async activatePanel(){let o=this.app.workspace.getLeavesOfType(v)[0];if(o){this.app.workspace.revealLeaf(o);return}let t=this.app.workspace.getRightLeaf(!1);t&&(await t.setViewState({type:v,active:!0}),this.app.workspace.revealLeaf(t))}updatePanel(){let e=this.app.workspace.getLeavesOfType(v);for(let o of e){let t=o.view,s=this.app.workspace.getActiveFile();t.updateForFile(s)}}postProcessor(e,o){let t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),s=[],l;for(;l=t.nextNode();){let p=l.textContent||"",c=f(p);c.length>0&&s.push({node:l,props:c})}for(let{node:p,props:c}of s.reverse()){let i=p.textContent||"";for(let a of c.reverse()){let h=i.slice(a.from,a.to).indexOf("[");if(h===-1)continue;let u=i.slice(0,a.from+h),m=i.slice(a.from+h,a.to),x=i.slice(a.to),k=document.createElement("span");k.className="block-property block-property-reading",k.textContent=m,k.setAttribute("data-block-id",a.blockId),k.setAttribute("data-properties",JSON.stringify(a.properties)),k.addEventListener("mouseenter",M=>{this.showReadingTooltip(M.target,a)}),k.addEventListener("mouseleave",()=>{this.hideReadingTooltip()});let g=p.parentNode;if(g){let M=document.createTextNode(u),q=document.createTextNode(x);g.insertBefore(M,p),g.insertBefore(k,p),g.insertBefore(q,p),g.removeChild(p)}}}}showReadingTooltip(e,o){this.hideReadingTooltip();let t=document.createElement("div");t.className="block-properties-tooltip block-properties-reading-tooltip";let s=document.createElement("div");s.className="block-properties-tooltip-header",s.textContent=`^${o.blockId}`,t.appendChild(s);let l=document.createElement("div");l.className="block-properties-tooltip-list";for(let c of o.properties){let i=document.createElement("div");i.className="block-properties-tooltip-item";let a=document.createElement("span");a.className="block-properties-tooltip-key",a.textContent=c.key;let n=document.createElement("span");n.className="block-properties-tooltip-value",n.textContent=c.value,i.appendChild(a),i.appendChild(n),l.appendChild(i)}t.appendChild(l);let p=e.getBoundingClientRect();t.style.position="fixed",t.style.left=`${p.left}px`,t.style.top=`${p.top-8}px`,t.style.transform="translateY(-100%)",t.style.zIndex="1000",document.body.appendChild(t),this.readingTooltip=t}hideReadingTooltip(){this.readingTooltip&&(this.readingTooltip.remove(),this.readingTooltip=null)}onunload(){this.styleEl&&this.styleEl.remove()}async loadSettings(){this.settings=Object.assign({},$,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}updateStyles(){this.styleEl||(this.styleEl=document.createElement("style"),this.styleEl.id="block-properties-styles",document.head.appendChild(this.styleEl)),this.styleEl.textContent=`
			.block-property {
				color: ${this.settings.propertyColor};
				opacity: ${this.settings.opacity};
				font-size: 0.9em;
			}
		`}refreshEditorExtension(){let e=V(this.settings.displayMode);this.editorExtension.length=0,this.editorExtension.push(...e),this.app.workspace.updateOptions()}};
